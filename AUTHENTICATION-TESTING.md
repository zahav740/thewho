# Тестирование системы аутентификации

## Проверка backend API

### 1. Проверка входа в систему
```bash
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "kasuf",
    "password": "kasuf123"
  }'
```

Ожидаемый ответ:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "kasuf",
    "role": "admin"
  }
}
```

### 2. Проверка защищенного маршрута
```bash
curl -X GET http://localhost:3001/api/auth/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### 3. Проверка без токена (должна вернуть 401)
```bash
curl -X GET http://localhost:3001/api/auth/profile
```

## Проверка frontend

1. Откройте http://localhost:3000
2. Вы должны увидеть страницу входа
3. Введите учетные данные:
   - Логин: kasuf
   - Пароль: kasuf123
4. После входа вы должны попасть на главную страницу CRM
5. В правом верхнем углу должна отображаться информация о пользователе

## Тестовые сценарии

### Сценарий 1: Успешный вход
1. Перейдите на http://localhost:3000
2. Введите правильные учетные данные
3. Проверьте, что вы перенаправлены на /database
4. Проверьте отображение имени пользователя в header

### Сценарий 2: Неправильные учетные данные
1. Введите неправильный пароль
2. Проверьте отображение ошибки
3. Убедитесь, что вход не выполнен

### Сценарий 3: Выход из системы
1. Войдите в систему
2. Нажмите кнопку "Выход"
3. Проверьте перенаправление на страницу входа
4. Попробуйте перейти на защищенную страницу напрямую

### Сценарий 4: Попытка доступа без аутентификации
1. Очистите localStorage в браузере
2. Попробуйте перейти на http://localhost:3000/database
3. Проверьте перенаправление на /login

### Сценарий 5: Истечение токена
1. В AuthContext.tsx временно измените время жизни токена на 5 секунд
2. Войдите в систему
3. Подождите 5 секунд
4. Выполните любое действие
5. Проверьте автоматический выход

## Возможные проблемы и решения

### Backend не запускается
- Проверьте, что PostgreSQL запущен
- Проверьте подключение к базе данных
- Убедитесь, что все зависимости установлены

### Frontend показывает ошибки API
- Проверьте REACT_APP_API_URL в .env
- Убедитесь, что backend запущен на правильном порту
- Проверьте CORS настройки в main.ts

### Не работает аутентификация
- Проверьте, что таблица users создана
- Убедитесь, что пользователь kasuf существует
- Проверьте JWT_SECRET в переменных окружения

### Компоненты не отображаются
- Очистите cache браузера
- Перезапустите frontend сервер
- Проверьте консоль браузера на ошибки

## Логи для отладки

Проверьте логи в консоли:
- Backend: логи в терминале где запущен npm run start:dev
- Frontend: логи в DevTools браузера (F12)
- База данных: проверьте подключение через psql или pgAdmin
