# ๐ ะฃััะฐะฝะพะฒะบะฐ Enhanced Calendar System

## ะะฑะทะพั ะธะทะผะตะฝะตะฝะธะน

ะฃะปัััะตะฝะฝะฐั ัะธััะตะผะฐ ะบะฐะปะตะฝะดะฐัั ัะตัะฐะตั ะฒัะต ะฒััะฒะปะตะฝะฝัะต ะฟัะพะฑะปะตะผั:

### โ ะงัะพ ะธัะฟัะฐะฒะปะตะฝะพ:
- โ **ะัะฐะฒะธะปัะฝัะต ัะฐะฑะพัะธะต ะดะฝะธ**: ะััะฝะธัะฐ-ััะฑะฑะพัะฐ ัะตะฟะตัั ะฒััะพะดะฝัะต
- โ **ะะฐััะตั ะฟัะพะดะพะปะถะธัะตะปัะฝะพััะธ**: ะะฟะตัะฐัะธะธ ัะฐัััะธััะฒะฐัััั ะฒ ัะฐะฑะพัะธั ะดะฝัั  
- โ **ะะตัะฐะปะธะทะฐัะธั ัะผะตะฝ**: ะะพะบะฐะทัะฒะฐะตั ะดะฝะตะฒะฝัะต/ะฝะพัะฝัะต ัะผะตะฝั ะพัะดะตะปัะฝะพ
- โ **ะััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต**: ะัะพะฑัะฐะถะฐะตั ะฒัะฟะพะปะฝะตะฝะฝัะน ะพะฑัะตะผ ะฟะพ ะฟัะพัะตะดัะธะผ ะดะฝัะผ
- โ **ะัะตะผั ะฝะฐะปะฐะดะบะธ**: ะะพะบะฐะทัะฒะฐะตั ะฝะฐะปะฐะดะบั ะดะปั ะดะฝะตะฒะฝัั ัะผะตะฝ (๐ง)
- โ **ะญััะตะบัะธะฒะฝะพััั**: ะะฐัััะธััะฒะฐะตั ะธ ะฟะพะบะฐะทัะฒะฐะตั ัััะตะบัะธะฒะฝะพััั ะพะฟะตัะฐัะพัะพะฒ

### ๐ ะะฐะฝะฝัะต ะฒ ะบะฐะปะตะฝะดะฐัะต:
- **ะะฐะทะฒะฐะฝะธะต ััะฐะฝะบะฐ** - ะบะพะด ะธ ัะธะฟ ะพะฑัะฐะฑะพัะบะธ
- **ะะฑัะตะต ะบะพะปะธัะตััะฒะพ** - ะดะตัะฐะปะตะน ะทะฐ ะดะฝะตะฒะฝัั (โ๏ธ) ะธ ะฝะพัะฝัั (๐) ัะผะตะฝั
- **ะะฐะปะฐะดะบะฐ** - ะฒัะตะผั ะฝะฐะปะฐะดะบะธ ะพัะพะฑัะฐะถะฐะตััั ะทะฝะฐัะบะพะผ ๐ง
- **ะญััะตะบัะธะฒะฝะพััั** - ะฟัะพัะตะฝั ะฒัะฟะพะปะฝะตะฝะธั ะฟะปะฐะฝะฐ ะฟะพ ะฒัะตะผะตะฝะธ
- **ะัะพะดะพะปะถะธัะตะปัะฝะพััั** - ัะฐััะตั ะฒ ัะฐะฑะพัะธั ะดะฝัั

## ๐ ะะฝััััะบัะธั ะฟะพ ัััะฐะฝะพะฒะบะต

### 1. Backend ะธะทะผะตะฝะตะฝะธั

#### 1.1 ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะตัะฒะธัะพะฒ
ะคะฐะนะปั ัะถะต ัะพะทะดะฐะฝั:
- `backend/src/modules/calendar/enhanced-calendar.service.ts`
- `backend/src/modules/calendar/enhanced-calendar.controller.ts`

#### 1.2 ะะฑะฝะพะฒะปะตะฝะธะต ะผะพะดัะปั ะบะฐะปะตะฝะดะฐัั
ะคะฐะนะป `backend/src/modules/calendar/calendar.module.ts` ัะถะต ะพะฑะฝะพะฒะปะตะฝ.

### 2. Frontend ะธะทะผะตะฝะตะฝะธั

#### 2.1 ะะพะฒัะต ะบะพะผะฟะพะฝะตะฝัั
ะคะฐะนะปั ัะพะทะดะฐะฝั:
- `frontend/src/services/enhancedCalendarApi.ts`
- `frontend/src/pages/Calendar/components/EnhancedProductionCalendar.tsx`
- `frontend/src/pages/Calendar/EnhancedCalendarPage.tsx`

#### 2.2 ะะฑะฝะพะฒะปะตะฝะฝัะน CalendarPage
ะคะฐะนะป `frontend/src/pages/Calendar/CalendarPage.tsx` ะพะฑะฝะพะฒะปะตะฝ ั ะฟะตัะตะบะปััะฐัะตะปะตะผ ะฒะตััะธะน.

### 3. ะะฐะทะฐ ะดะฐะฝะฝัั

#### 3.1 ะัะฟะพะปะฝะธัะต SQL ัะบัะธะฟั
```bash
# ะะพะดะบะปััะธัะตัั ะบ ะฒะฐัะตะน ะฑะฐะทะต PostgreSQL
psql -h localhost -U postgres -d thewho

# ะัะฟะพะปะฝะธัะต ัะบัะธะฟั
\i enhanced_calendar_setup.sql
```

#### 3.2 ะงัะพ ัะพะทะดะฐะตััั:
- `working_days_settings` - ะฝะฐัััะพะนะบะธ ัะฐะฑะพัะธั ะดะฝะตะน
- `working_time_templates` - ัะฐะฑะปะพะฝั ัะผะตะฝ  
- `operation_planning` - ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต ะพะฟะตัะฐัะธะน
- `calendar_events` - ัะพะฑััะธั ะบะฐะปะตะฝะดะฐัั
- ะคัะฝะบัะธะธ ัะฐััะตัะฐ ัะฐะฑะพัะธั ะดะฝะตะน
- ะขะตััะพะฒัะต ะดะฐะฝะฝัะต

### 4. ะะฐะฟััะบ ัะธััะตะผั

#### 4.1 Backend
```bash
cd backend
npm run start:dev
```

#### 4.2 Frontend  
```bash
cd frontend
npm start
```

### 5. ะัะพะฒะตัะบะฐ ัะฐะฑะพัั

1. ะัะบัะพะนัะต ัััะฐะฝะธัั **ะะฐะปะตะฝะดะฐัั** ะฒ CRM
2. ะฃะฒะธะดะธัะต ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะฝะพะฒะพะน ะฒะตััะธะธ ะบะฐะปะตะฝะดะฐัั
3. ะะพ ัะผะพะปัะฐะฝะธั ะทะฐะณััะถะฐะตััั **Enhanced ะบะฐะปะตะฝะดะฐัั**
4. ะะตัะตะบะปััะธัะตัั ะผะตะถะดั ะฒะตััะธัะผะธ ะบะฝะพะฟะบะพะน ะฒ ะฟัะฐะฒะพะผ ะฒะตััะฝะตะผ ัะณะปั

## ๐ฏ ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั Enhanced ะบะฐะปะตะฝะดะฐัั

### ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ:

1. **ะััะพะดะฝัะต ะดะฝะธ**: ะััะฝะธัะฐ-ััะฑะฑะพัะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพัะผะตัะตะฝั ะบะฐะบ ะฒััะพะดะฝัะต ๐๏ธ
2. **ะะตัะฐะปะธะทะฐัะธั ัะผะตะฝ**: 
   - โ๏ธ ะะฝะตะฒะฝะฐั ัะผะตะฝะฐ (8:00-16:00)
   - ๐ ะะพัะฝะฐั ัะผะตะฝะฐ (20:00-04:00)
3. **ะะฐะปะฐะดะบะฐ**: ะัะพะฑัะฐะถะฐะตััั ะทะฝะฐัะบะพะผ ๐ง ะดะปั ะดะฝะตะฒะฝัั ัะผะตะฝ
4. **ะญััะตะบัะธะฒะฝะพััั**: ะฆะฒะตัะพะฒัะต ะธะฝะดะธะบะฐัะพัั ะพั ะบัะฐัะฝะพะณะพ ะดะพ ะทะตะปะตะฝะพะณะพ
5. **Tooltip**: ะะฐะฒะตะดะธัะต ะบัััะพั ะฝะฐ ััะตะนะบั ะดะปั ะดะตัะฐะปัะฝะพะน ะธะฝัะพัะผะฐัะธะธ

### ะะฐัััะพะนะบะธ ะพัะพะฑัะฐะถะตะฝะธั:

- **ะะพะบะฐะทัะฒะฐัั ะฒััะพะดะฝัะต** - ะฒะบะปััะธัั/ะฒัะบะปััะธัั ะฒััะพะดะฝัะต ะดะฝะธ
- **ะะพะบะฐะทัะฒะฐัั ัััะตะบัะธะฒะฝะพััั** - ะฟะพะบะฐะทะฐัะตะปะธ ัััะตะบัะธะฒะฝะพััะธ ะพะฟะตัะฐัะพัะพะฒ  
- **ะะพะบะฐะทัะฒะฐัั ะฝะฐะปะฐะดะบั** - ะฒัะตะผั ะฝะฐะปะฐะดะบะธ
- **ะะตะถะธะผ ะพัะพะฑัะฐะถะตะฝะธั** - ะดะตัะฐะปะธะทะธัะพะฒะฐะฝะฝัะน/ะบะพะผะฟะฐะบัะฝัะน

### ะฆะฒะตัะพะฒะฐั ััะตะผะฐ:

- ๐ข **ะะตะปะตะฝัะน** - ะฒััะพะบะฐั ัััะตะบัะธะฒะฝะพััั (>90%)
- ๐ต **ะกะธะฝะธะน** - ัะพัะพัะฐั ัััะตะบัะธะฒะฝะพััั (75-90%)
- ๐ก **ะะตะปััะน** - ััะตะดะฝัั ัััะตะบัะธะฒะฝะพััั (60-75%)
- ๐ด **ะัะฐัะฝัะน** - ะฝะธะทะบะฐั ัััะตะบัะธะฒะฝะพััั (<60%)

## ๐ API ัะฝะดะฟะพะธะฝัั

### ะะพะฒัะต ัะฝะดะฟะพะธะฝัั Enhanced ะบะฐะปะตะฝะดะฐัั:

```
GET /api/calendar/enhanced
GET /api/calendar/enhanced/working-days  
GET /api/calendar/enhanced/operation-duration
GET /api/calendar/enhanced/machine-summary
```

### ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ:

```bash
# ะะพะปััะธัั ะบะฐะปะตะฝะดะฐัั
curl "http://localhost:5100/api/calendar/enhanced?startDate=2025-06-11&endDate=2025-06-25"

# ะะฐัััะธัะฐัั ัะฐะฑะพัะธะต ะดะฝะธ
curl "http://localhost:5100/api/calendar/enhanced/working-days?startDate=2025-06-11&endDate=2025-06-25"

# ะะฐัััะธัะฐัั ะฟัะพะดะพะปะถะธัะตะปัะฝะพััั ะพะฟะตัะฐัะธะธ
curl "http://localhost:5100/api/calendar/enhanced/operation-duration?timePerPart=20&quantity=100&setupTime=120"
```

## ๐ง ะะฐััะพะผะธะทะฐัะธั

### ะะทะผะตะฝะตะฝะธะต ัะฐะฑะพัะธั ะดะฝะตะน:
```sql
-- ะะฑะฝะพะฒะธัั ะฟะฐััะตัะฝ ัะฐะฑะพัะธั ะดะฝะตะน ะดะปั 2025 ะณะพะดะฐ
UPDATE working_days_settings 
SET working_days_pattern = '1111100' -- ะะพะฝะตะดะตะปัะฝะธะบ-ะฟััะฝะธัะฐ ัะฐะฑะพัะธะต
WHERE year = 2025;
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฟัะฐะทะดะฝะธะบะพะฒ:
```sql
-- ะะพะฑะฐะฒะธัั ะฟัะฐะทะดะฝะธะบะธ
UPDATE working_days_settings 
SET holidays = ARRAY['2025-01-01', '2025-05-01', '2025-12-25', '2025-06-12']
WHERE year = 2025;
```

### ะะฐัััะพะนะบะฐ ะฒัะตะผะตะฝะธ ัะผะตะฝ:
```sql
-- ะะฑะฝะพะฒะธัั ัะฐะฑะพัะตะต ะฒัะตะผั
UPDATE working_time_templates 
SET day_shift_start = '07:00', day_shift_end = '15:00'
WHERE name = 'ะกัะฐะฝะดะฐััะฝัะน (2 ัะผะตะฝั)';
```

## ๐ ะะพัะพะฒะพ!

Enhanced Calendar System ัััะฐะฝะพะฒะปะตะฝ ะธ ะณะพัะพะฒ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!

**ะัะฝะพะฒะฝัะต ะฟัะตะธะผััะตััะฒะฐ:**
- โ ะัะฐะฒะธะปัะฝัะน ัะฐััะตั ัะฐะฑะพัะธั ะดะฝะตะน (ะฟััะฝะธัะฐ-ััะฑะฑะพัะฐ ะฒััะพะดะฝัะต)
- โ ะะตัะฐะปะธะทะฐัะธั ะฟะพ ัะผะตะฝะฐะผ ั ะพะฟะตัะฐัะพัะฐะผะธ ะธ ัััะตะบัะธะฒะฝะพัััั
- โ ะัะพะฑัะฐะถะตะฝะธะต ะฒัะตะผะตะฝะธ ะฝะฐะปะฐะดะบะธ
- โ ะะฐััะตั ะฟัะพะดะพะปะถะธัะตะปัะฝะพััะธ ะพะฟะตัะฐัะธะน ะฒ ัะฐะฑะพัะธั ะดะฝัั
- โ ะััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต ะฟะพ ะฟัะพัะตะดัะธะผ ะดะฝัะผ
- โ ะกะพะฒัะตะผะตะฝะฝัะน ะธะฝัะตััะตะนั ั tooltip'ะฐะผะธ

ะขะตะฟะตัั ะฒะฐั ะบะฐะปะตะฝะดะฐัั ะฟะพะบะฐะทัะฒะฐะตั ะฒัั ะฝะตะพะฑัะพะดะธะผัั ะธะฝัะพัะผะฐัะธั ะดะปั ัััะตะบัะธะฒะฝะพะณะพ ะฟะปะฐะฝะธัะพะฒะฐะฝะธั ะฟัะพะธะทะฒะพะดััะฒะฐ! ๐
