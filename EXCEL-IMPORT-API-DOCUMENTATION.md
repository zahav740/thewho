# üìä API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel –∏–º–ø–æ—Ä—Ç–æ–º –∑–∞–∫–∞–∑–æ–≤

## üîç –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞ Excel

### 1. **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ Excel —Ñ–∞–π–ª–∞**
**Endpoint:** `POST /api/enhanced-orders/analyze-excel`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç Excel —Ñ–∞–π–ª –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```
- excel: —Ñ–∞–π–ª (multipart/form-data)
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "fileName": "orders.xlsx",
    "totalRows": 72,
    "orders": [
      {
        "rowNumber": 2,
        "drawingNumber": "DRW-001",
        "quantity": 10,
        "deadline": "31.12.2025",
        "priority": "–í—ã—Å–æ–∫–∏–π",
        "workType": "–§—Ä–µ–∑–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞",
        "color": "red",
        "colorLabel": "üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã",
        "operations": [
          {
            "number": 1,
            "type": "–§—Ä–µ–∑–µ—Ä–Ω–∞—è",
            "time": 120,
            "axes": 3
          }
        ],
        "selected": true,
        "exists": false
      }
    ],
    "colorStatistics": {
      "green": { "count": 15, "label": "üü¢ –ì–æ—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã" },
      "yellow": { "count": 25, "label": "üü° –û–±—ã—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã" },
      "red": { "count": 18, "label": "üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã" },
      "blue": { "count": 14, "label": "üîµ –ü–ª–∞–Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã" }
    },
    "recommendedFilters": [
      {
        "color": "red",
        "label": "üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã",
        "count": 18,
        "description": "–°—Ä–æ—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (18 —à—Ç.)",
        "priority": 1,
        "recommended": true
      }
    ]
  },
  "message": "–ù–∞–π–¥–µ–Ω–æ 72 –∑–∞–∫–∞–∑–∞ –≤ —Ñ–∞–π–ª–µ orders.xlsx"
}
```

### 2. **–í—ã–±–æ—Ä–æ—á–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤**
**Endpoint:** `POST /api/enhanced-orders/import-selected-orders`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø–æ —Ü–≤–µ—Ç–æ–≤—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º –∏/–∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –Ω–æ–º–µ—Ä–∞–º —á–µ—Ä—Ç–µ–∂–µ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```
- excel: —Ñ–∞–π–ª (multipart/form-data)
- selectedOrders: JSON –º–∞—Å—Å–∏–≤ –Ω–æ–º–µ—Ä–æ–≤ —á–µ—Ä—Ç–µ–∂–µ–π ["DRW-001", "DRW-005"]
- clearExisting: "true" | "false" - –æ—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- skipDuplicates: "true" | "false" - –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã
- colorFilters: JSON –º–∞—Å—Å–∏–≤ —Ü–≤–µ—Ç–æ–≤ ["red", "yellow"]
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```javascript
const formData = new FormData();
formData.append('excel', file);
formData.append('selectedOrders', JSON.stringify(["DRW-001", "DRW-005", "DRW-010"]));
formData.append('clearExisting', 'false');
formData.append('skipDuplicates', 'true');
formData.append('colorFilters', JSON.stringify(["red", "yellow"]));

fetch('/api/enhanced-orders/import-selected-orders', {
  method: 'POST',
  body: formData
});
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! –°–æ–∑–¥–∞–Ω–æ: 15, –û–±–Ω–æ–≤–ª–µ–Ω–æ: 3, –û—à–∏–±–æ–∫: 0",
  "data": {
    "totalRows": 18,
    "processedRows": 18,
    "created": 15,
    "updated": 3,
    "errors": [],
    "colorStatistics": {
      "red": 8,
      "yellow": 10
    },
    "summary": {
      "greenOrders": 0,
      "yellowOrders": 10,
      "redOrders": 8,
      "blueOrders": 0
    }
  }
}
```

### 3. **–ü–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏**
**Endpoint:** `POST /api/enhanced-orders/upload-excel-full`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å Excel —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–º–ø–æ—Ä—Ç–∞

## üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤:
1. **üü¢ –ó–µ–ª–µ–Ω—ã–π (–ì–æ—Ç–æ–≤—ã–µ)** - –ó–∞–∫–∞–∑—ã –≥–æ—Ç–æ–≤—ã–µ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É
2. **üü° –ñ–µ–ª—Ç—ã–π (–û–±—ã—á–Ω—ã–µ)** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–∫–∞–∑—ã
3. **üî¥ –ö—Ä–∞—Å–Ω—ã–π (–ö—Ä–∏—Ç–∏—á–Ω—ã–µ)** - –°—Ä–æ—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
4. **üîµ –°–∏–Ω–∏–π (–ü–ª–∞–Ω–æ–≤—ã–µ)** - –ü–ª–∞–Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –Ω–∞ –±—É–¥—É—â–µ–µ

### –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞:

1. **–ü–æ —Ü–≤–µ—Ç—É —è—á–µ–π–∫–∏ Excel** (–µ—Å–ª–∏ –µ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. **–ü–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Ç–µ–∫—Å—Ç–∞:**
   - –ó–µ–ª–µ–Ω—ã–π: "–≥–æ—Ç–æ–≤", "ready", "completed", "done"
   - –ö—Ä–∞—Å–Ω—ã–π: "–∫—Ä–∏—Ç–∏—á", "—Å—Ä–æ—á–Ω", "critical", "urgent"
   - –°–∏–Ω–∏–π: "–ø–ª–∞–Ω", "plan", "scheduled"
   - –ñ–µ–ª—Ç—ã–π: –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Excel —Ñ–∞–π–ª–∞

### –û–∂–∏–¥–∞–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
- **A (–ù–æ–º–µ—Ä —á–µ—Ä—Ç–µ–∂–∞)** - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞
- **B (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ)** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–¥–µ–ª–∏–π –¥–ª—è –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
- **C (–°—Ä–æ–∫)** - –î–µ–¥–ª–∞–π–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- **D (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)** - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–∫–∞–∑–∞ (1-4 –∏–ª–∏ —Ç–µ–∫—Å—Ç)
- **E (–¢–∏–ø —Ä–∞–±–æ—Ç—ã)** - –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç
- **F+ (–û–ø–µ—Ä–∞—Ü–∏–∏)** - –ë–ª–æ–∫–∏ –ø–æ 4 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é:
  - –ù–æ–º–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏
  - –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ñ—Ä–µ–∑–µ—Ä–Ω–∞—è/—Ç–æ–∫–∞—Ä–Ω–∞—è)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–µ–π
  - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º–∏–Ω)

### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```
| A        | B  | C          | D       | E               | F | G          | H | I   |
|----------|----|-----------|---------|-----------------|----|------------|---|-----|
| DRW-001  | 10 | 31.12.2025 | –í—ã—Å–æ–∫–∏–π | –§—Ä–µ–∑–µ—Ä–Ω–∞—è      | 1  | –§—Ä–µ–∑–µ—Ä–Ω–∞—è  | 3 | 120 |
| DRW-002  | 5  | 15.01.2026 | –°—Ä–µ–¥–Ω–∏–π | –¢–æ–∫–∞—Ä–Ω–∞—è       | 1  | –¢–æ–∫–∞—Ä–Ω–∞—è   | 2 | 90  |
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Frontend

### 1. –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º:
```javascript
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞
const analyzeFile = async (file) => {
  const formData = new FormData();
  formData.append('excel', file);
  
  const response = await fetch('/api/enhanced-orders/analyze-excel', {
    method: 'POST',
    body: formData
  });
  
  const result = await response.json();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
  displayOrdersList(result.data.orders);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ü–≤–µ—Ç–∞–º
  displayColorStatistics(result.data.colorStatistics);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
  displayRecommendedFilters(result.data.recommendedFilters);
};
```

### 2. –í—ã–±–æ—Ä–æ—á–Ω—ã–π –∏–º–ø–æ—Ä—Ç:
```javascript
// –ò–º–ø–æ—Ä—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
const importSelected = async (file, selectedOrders, colorFilters) => {
  const formData = new FormData();
  formData.append('excel', file);
  formData.append('selectedOrders', JSON.stringify(selectedOrders));
  formData.append('colorFilters', JSON.stringify(colorFilters));
  formData.append('clearExisting', 'false');
  formData.append('skipDuplicates', 'true');
  
  const response = await fetch('/api/enhanced-orders/import-selected-orders', {
    method: 'POST',
    body: formData
  });
  
  const result = await response.json();
  
  if (result.success) {
    showSuccessMessage(result.message);
    refreshOrdersList();
  } else {
    showErrorMessage(result.message);
  }
};
```

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:
- **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞** - —Ç–æ–ª—å–∫–æ .xlsx, .xls –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
- **–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª** - —Ñ–∞–π–ª –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω
- **–ü—É—Å—Ç–æ–π —Ñ–∞–π–ª** - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
- **–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –Ω–æ–º–µ—Ä–∞ —á–µ—Ä—Ç–µ–∂–µ–π** - –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö** - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞—Ç—ã –∏–ª–∏ —á–∏—Å–ª–∞

### –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```javascript
try {
  const result = await importSelected(file, selected, filters);
  
  if (result.success) {
    console.log('–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ:', result.data.created);
    if (result.data.errors.length > 0) {
      console.warn('–û—à–∏–±–∫–∏ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:', result.data.errors);
    }
  } else {
    console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', result.message);
  }
} catch (error) {
  console.error('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:', error);
}
```

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-06-09
**–í–µ—Ä—Å–∏—è API:** Enhanced Orders v2.0
