# Руководство по экспорту Excel календаря производства

## Обзор функциональности

Новая система экспорта Excel позволяет экспортировать данные производственного календаря с расширенными настройками фильтрации и форматирования.

## Возможности экспорта

### 1. Выбор периода экспорта

- **Текущий месяц/неделя**: Экспорт данных за текущий отображаемый период
- **Выбранный период**: Произвольный диапазон дат (с датой начала и окончания)
- **Весь календарь**: Экспорт всех доступных данных календаря

### 2. Форматы экспорта

#### Сводный отчет
- Основные данные по операциям
- Колонки: Дата, Номер чертежа, Операция, Количество, Станок, Статус, Начало, Окончание, Длительность

#### Детальный отчет
- Расширенная информация с аналитикой
- Дополнительные колонки: день недели, плановое/фактическое время, отклонения, эффективность

### 3. Фильтрация данных

- **По станкам**: Выбор конкретных станков или всех станков
- **По статусам**: Фильтрация по статусам операций (завершено, в работе, запланировано, перенесено)

### 4. Дополнительные листы Excel

#### Лист "Статистика"
- Общие показатели
- Распределение по статусам
- Загрузка станков
- ТОП чертежей по количеству операций

#### Лист "Загрузка станков"
- Анализ использования каждого станка
- Общее время работы
- Средняя длительность операций
- Статус загрузки

## Как использовать

### Шаг 1: Открытие модального окна экспорта
1. В компоненте производственного календаря нажмите кнопку "Экспорт" с иконкой загрузки
2. Откроется модальное окно с настройками экспорта

### Шаг 2: Настройка параметров экспорта

#### Выбор периода:
- Выберите нужный период экспорта (текущий период, произвольный или весь календарь)
- При выборе произвольного периода укажите даты начала и окончания

#### Выбор формата:
- Сводный отчет: для быстрого обзора операций
- Детальный отчет: для глубокого анализа с метриками эффективности

#### Настройка фильтров:
- Станки: выберите конкретные станки или оставьте "Все станки"
- Статусы: выберите нужные статусы операций или оставьте "Все статусы"

### Шаг 3: Экспорт
1. Проверьте информацию в разделе "Будет экспортировано"
2. Нажмите кнопку "Экспортировать"
3. Файл автоматически скачается в папку загрузок

## Структура экспортируемого файла

### Именование файлов
Файлы именуются по шаблону:
`Production_Calendar_{формат}_{период}.xlsx`

Примеры:
- `Production_Calendar_summary_Январь_2025.xlsx`
- `Production_Calendar_detailed_Week_2_Январь_2025.xlsx`
- `Production_Calendar_summary_Custom_2025-01-01_2025-01-31.xlsx`

### Листы Excel

1. **Сводный отчет / Детальный отчет** - основные данные
2. **Статистика** - аналитическая информация
3. **Загрузка станков** - анализ использования оборудования

## Технические детали

### Используемые библиотеки
- `xlsx` - для создания и форматирования Excel файлов
- `react-i18next` - для локализации интерфейса

### Поддерживаемые форматы
- Excel (.xlsx) с поддержкой стилей и форматирования
- Автоматическая настройка ширины колонок
- Цветовое выделение заголовков

### Структура кода

#### Основные компоненты:
- `ExcelExportModal.tsx` - модальное окно настроек экспорта
- `excelExport.ts` - утилиты для создания Excel файлов
- `ProductionCalendar.tsx` - интеграция с календарем

#### Ключевые функции:
- `exportCalendarToExcel()` - основная функция экспорта
- `createSummarySheet()` - создание сводного отчета
- `createDetailedSheet()` - создание детального отчета
- `createStatisticsSheet()` - создание листа статистики
- `createMachineUtilizationSheet()` - создание листа загрузки станков

## Кастомизация

### Добавление новых колонок
Для добавления новых колонок в отчеты отредактируйте соответствующие функции в файле `excelExport.ts`:

```typescript
// Пример добавления новой колонки
const headers = [
  'Существующие колонки...',
  'Новая колонка'
];

// Добавьте данные для новой колонки
exportData.push([
  // ... существующие данные
  'Значение новой колонки'
]);
```

### Изменение стилей
Модифицируйте функцию `addHeaderStyles()` для изменения оформления заголовков или добавьте новые стили для ячеек данных.

## Локализация

Все текстовые строки поддерживают локализацию. Для добавления нового языка:

1. Добавьте переводы в соответствующий файл локализации (`en.ts`, `ru.ts`)
2. Ключи для экспорта Excel начинаются с префикса `excel_export_`, `export_`, `summary_`, `detailed_`

## Требования

- Node.js >= 14
- React >= 18
- TypeScript
- Библиотека `xlsx`

## Известные ограничения

1. Максимальный размер экспорта ограничен памятью браузера
2. Очень большие объемы данных могут замедлить процесс экспорта
3. Файлы сохраняются только в папку загрузок браузера

## Решение проблем

### Проблема: Файл не скачивается
**Решение**: Проверьте настройки браузера для автоматической загрузки файлов

### Проблема: Некорректное отображение дат
**Решение**: Убедитесь, что локаль браузера настроена правильно

### Проблема: Отсутствуют данные в экспорте
**Решение**: Проверьте фильтры и убедитесь, что в выбранном периоде есть операции

## Поддержка

Для получения технической поддержки или сообщения об ошибках обратитесь к команде разработки.
