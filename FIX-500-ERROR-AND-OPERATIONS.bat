@echo off
chcp 65001 > nul
echo ============================================
echo ИСПРАВЛЕНИЕ ОШИБКИ 500 И СОХРАНЕНИЯ ОПЕРАЦИЙ
echo ============================================
echo.
echo Применены следующие изменения:
echo.
echo 1. ИСПРАВЛЕНА ОШИБКА 500:
echo    - Убрана циклическая зависимость между Order и Operation
echo    - Операции загружаются отдельным запросом
echo.
echo 2. СОХРАНЕНИЕ ОПЕРАЦИЙ:
echo    - Операции сохраняются при создании заказа
echo    - Операции обновляются при редактировании заказа
echo    - Операции загружаются при просмотре заказа
echo.
echo ============================================
echo.
echo Остановка приложения...
taskkill /F /IM node.exe 2>nul
timeout /t 2 /nobreak > nul
echo.
echo Перезапуск backend и frontend...
start cmd /k "cd backend && npm start"
timeout /t 5 /nobreak > nul
start cmd /k "cd frontend && npm start"
echo.
echo ============================================
echo Приложение перезапущено!
echo.
echo Backend: http://localhost:3001
echo Frontend: http://localhost:3000
echo.
echo Теперь:
echo - Страница заказов загружается без ошибки 500
echo - Операции сохраняются при создании/редактировании
echo - Операции отображаются при открытии заказа
echo ============================================
pause
