# Обновление системы планирования в TheWho

## Исправления и улучшения

В систему планирования производственных операций были внесены следующие изменения:

### 1. Добавлена поддержка смены станка при наладке

Теперь при отметке наладки как выполненной можно указать станок, на котором фактически была выполнена наладка. 
Если этот станок отличается от первоначально запланированного, система:

- Автоматически обновляет информацию о станке в результате планирования
- Выполняет полное перепланирование операций на всех затронутых станках (старом и новом)
- Корректно обновляет все связанные данные и визуализации

### 2. Улучшена синхронизация с Supabase

После любых изменений в планировании (включая смену станка, изменение времени наладки и т.д.) 
данные автоматически синхронизируются с базой данных Supabase. Это обеспечивает:

- Целостность данных между локальной версией и базой
- Доступность актуального состояния планирования для всех пользователей
- Возможность анализа и отчетности на основе достоверных данных

### 3. Учет данных по сменам при планировании

- Информация из смен теперь учитывается при планировании
- Система анализирует фактическую производительность и корректирует планы
- Визуализирована статистика по сменам для улучшения анализа

## Как использовать новые возможности

### Смена станка при наладке:

1. Найдите нужную операцию в списке запланированных
2. Нажмите "Редактировать"
3. Выберите "Отметить наладку как выполненную"
4. В открывшемся окне:
   - Укажите фактический станок, на котором была выполнена наладка
   - Введите фактическое время наладки
   - Введите фактическое время начала
5. Нажмите "Сохранить и перепланировать"
6. Система автоматически перепланирует все связанные операции

### Анализ данных по сменам:

Смотрите раздел "Аналитика" -> "Статистика по сменам", который показывает:
- Эффективность выполнения операций
- Отклонения от планов
- Статистику по станкам и операторам

## Технические детали

- Создан новый модуль `setupCompletion.ts` с улучшенной функцией `markSetupCompleted`
- Обновлены компоненты `SetupCompletionModal` и `useProductionPlanning`
- Добавлен корректный импорт функции `syncWithSupabase` из модуля supabaseClient

## Известные ограничения

- Для корректной работы синхронизации с Supabase необходимо установить ключ API в .env 
- Максимальное количество операций на станок в день осталось прежним (2)
- Правило 14:00 также сохранено (если операция заканчивается до 14:00, больше операций в этот день не назначается)
