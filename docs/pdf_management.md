# Руководство по загрузке и управлению PDF-чертежами

Это руководство описывает возможности приложения TheWho для работы с PDF-файлами чертежей, включая их загрузку, хранение в Supabase и интеграцию с системой планирования.

## Содержание
1. [Загрузка PDF-файлов](#загрузка-pdf-файлов)
2. [Хранение PDF в Supabase](#хранение-pdf-в-supabase)
3. [Просмотр PDF-чертежей](#просмотр-pdf-чертежей)
4. [Управление файлами](#управление-файлами)
5. [Лучшие практики](#лучшие-практики)

## Загрузка PDF-файлов

### При создании заказа

1. При создании нового заказа в форме OrderForm используйте поле "Выберите PDF-чертеж"
2. Нажмите кнопку "Обзор" (или аналогичную) и выберите PDF-файл с чертежом
3. Выбранный файл автоматически загрузится вместе с созданием заказа
4. URL файла будет сохранен в поле `pdfUrl` соответствующего заказа

### При редактировании заказа

1. Откройте существующий заказ, нажав кнопку "Редактировать"
2. В открывшемся модальном окне найдите раздел для управления PDF-файлом
3. Вы можете заменить текущий файл, выбрав новый PDF-чертеж
4. После сохранения изменений новый файл будет загружен, а старый может быть автоматически удален

### Технический процесс загрузки

При загрузке файла происходит следующее:

1. Файл читается из формы с помощью File API
2. Создается уникальное имя файла на основе номера чертежа и временной метки
3. Файл загружается в бакет `pdf_files` в Supabase через Storage API
4. Генерируется публичный URL для доступа к файлу
5. URL сохраняется в соответствующем заказе

## Хранение PDF в Supabase

### Структура хранения

PDF-файлы хранятся в Supabase Storage в следующей структуре:
```
pdf_files/
  ├── drawings/
  │   ├── drawing_123_timestamp.pdf
  │   ├── drawing_456_timestamp.pdf
  │   └── ...
```

### Организация бакетов

В Supabase создан специальный бакет `pdf_files` с соответствующими политиками доступа:
- Загрузка файлов: только авторизованные пользователи
- Чтение файлов: публичное (по ссылке)
- Удаление файлов: только авторизованные пользователи

### Синхронизация с базой данных

При синхронизации данных с Supabase:
1. Все метаданные заказов, включая URL PDF-файлов, загружаются в таблицу `orders`
2. Сами файлы хранятся отдельно в Storage и не включаются в базу данных напрямую
3. Ссылки на файлы хранятся в поле `pdf_url` таблицы `orders`

## Просмотр PDF-чертежей

### Встроенный просмотрщик

В приложении реализован встроенный просмотрщик PDF-файлов:
1. При нажатии на ссылку "Просмотреть чертеж" открывается модальное окно
2. В окне загружается и отображается PDF-файл с использованием библиотеки react-pdf
3. Доступны функции масштабирования, перелистывания страниц и поворота

### Возможности просмотрщика

- Увеличение/уменьшение масштаба
- Переключение между страницами (для многостраничных PDF)
- Поворот документа
- Отображение текущей страницы/общего количества страниц
- Загрузка файла на локальный компьютер

### Производственный режим просмотра

Для использования в производственном цеху предусмотрен специальный режим просмотра:
1. Увеличенный масштаб по умолчанию
2. Меньше элементов управления для упрощения интерфейса
3. Полноэкранный режим

## Управление файлами

### Очистка неиспользуемых файлов

Для удаления неиспользуемых PDF-файлов:
1. В Supabase панели управления перейдите в раздел "Storage" -> "Buckets" -> "pdf_files"
2. Используйте интерфейс для просмотра и удаления ненужных файлов
3. Альтернативно, можно использовать автоматический скрипт очистки, который сравнивает файлы в хранилище с записями в базе данных

### Массовое редактирование

Для массового редактирования файлов:
1. Используйте Supabase API для программного доступа к хранилищу
2. Скрипты для массовой обработки файлов доступны в папке `scripts`
3. Для массовой загрузки файлов используйте специальный инструмент импорта в интерфейсе приложения

## Лучшие практики

### Оптимизация PDF-файлов

Для лучшей производительности рекомендуется:
1. Оптимизировать PDF-файлы перед загрузкой (уменьшение размера)
2. Использовать разрешение 150-300 DPI для чертежей (баланс между качеством и размером)
3. Удалять ненужные слои и метаданные из PDF-файлов

### Именование файлов

Рекомендуемая структура именования:
1. Используйте номер чертежа как основу имени файла
2. Добавляйте версию или дату изменения в имя файла
3. Избегайте специальных символов и пробелов в именах файлов

### Организация файлов

1. Храните все чертежи для одного заказа вместе
2. Используйте префиксы в именах файлов для группировки связанных чертежей
3. Добавляйте суффиксы для обозначения типа документа (например, _assy для сборочных чертежей)

### Резервное копирование

1. Регулярно создавайте резервные копии всех PDF-файлов
2. Используйте функцию экспорта в Supabase для сохранения всего содержимого бакета
3. Храните резервные копии на отдельном носителе или в другом облачном хранилище
