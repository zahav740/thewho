                      <Card
                        size="small"
                        hoverable
                        onClick={() => handleOperationClick(machine)}
                        style={{
                          borderRadius: '12px',
                          borderColor: getPriorityColor(priorityNum),
                          backgroundColor: priorityNum === 1 ? '#fff2f0' : priorityNum === 2 ? '#fff7e6' : '#f6ffed',
                          cursor: 'pointer',
                          transition: 'all 0.3s ease',
                          position: 'relative',
                          overflow: 'hidden'
                        }}
                        onMouseEnter={(e) => {
                          e.currentTarget.style.transform = 'translateY(-2px)';
                          e.currentTarget.style.boxShadow = `0 8px 16px ${getPriorityColor(priorityNum)}30`;
                        }}
                        onMouseLeave={(e) => {
                          e.currentTarget.style.transform = 'translateY(0)';
                          e.currentTarget.style.boxShadow = '';
                        }}
                        title={
                          <Space style={{ width: '100%', justifyContent: 'space-between' }}>
                            <Space>
                              <ToolOutlined style={{ color: getPriorityColor(priorityNum) }} />
                              <span style={{ color: getPriorityColor(priorityNum), fontWeight: 'bold' }}>
                                {machine.machineName}
                              </span>
                            </Space>
                            <Tooltip title="–û—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É">
                              <EyeOutlined style={{ color: '#1890ff', fontSize: '12px' }} />
                            </Tooltip>
                          </Space>
                        }
                      >
                        {/* –ü–æ–ª–æ—Å–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ */}
                        <div style={{
                          position: 'absolute',
                          top: 0,
                          left: 0,
                          right: 0,
                          height: '3px',
                          backgroundColor: getPriorityColor(priorityNum)
                        }} />

                        {machine.currentOperationDetails ? (
                          <>
                            <div style={{ marginBottom: '12px' }}>
                              <Space wrap>
                                <Tag color="blue" style={{ borderRadius: '12px' }}>
                                  üìã #{machine.currentOperationDetails.operationNumber}
                                </Tag>
                                <Tag color="green" style={{ borderRadius: '12px', fontSize: '11px' }}>
                                  {machine.currentOperationDetails.operationType}
                                </Tag>
                              </Space>
                            </div>
                            
                            <div style={{ marginBottom: '12px' }}>
                              <Text strong style={{ display: 'block', marginBottom: '4px', fontSize: '13px' }}>
                                üìÑ {machine.currentOperationDetails.orderDrawingNumber}
                              </Text>
                              <Space style={{ width: '100%', justifyContent: 'space-between' }}>
                                <Text type="secondary" style={{ fontSize: '11px' }}>
                                  ‚è±Ô∏è {formatEstimatedTime(machine.currentOperationDetails.estimatedTime)}
                                </Text>
                                <Text style={{ fontSize: '11px', color: deadline.color, fontWeight: 'bold' }}>
                                  üìÖ {deadline.text}
                                </Text>
                              </Space>
                            </div>

                            {/* –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è */}
                            {machine.currentOperationDetails.orderQuantity && (
                              <div style={{ marginBottom: '12px' }}>
                                <div style={{ marginBottom: '4px' }}>
                                  <Text style={{ fontSize: '11px' }}>
                                    üì¶ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: {machine.currentOperationDetails.producedQuantity || 0} / {machine.currentOperationDetails.orderQuantity}
                                  </Text>
                                </div>
                                <Progress 
                                  percent={Math.round(((machine.currentOperationDetails.producedQuantity || 0) / machine.currentOperationDetails.orderQuantity) * 100)}
                                  size="small"
                                  strokeColor={getPriorityColor(priorityNum)}
                                  showInfo={false}
                                />
                              </div>
                            )}
                            
                            {machine.lastFreedAt && (
                              <div style={{ marginBottom: '12px' }}>
                                <Text type="secondary" style={{ fontSize: '10px' }}>
                                  üïí –ù–∞—á–∞—Ç–æ: {new Date(machine.lastFreedAt).toLocaleString('ru-RU')}
                                </Text>
                              </div>
                            )}
                            
                            <div style={{ 
                              padding: '8px', 
                              backgroundColor: '#f0f9ff', 
                              borderRadius: '6px',
                              border: '1px dashed #1890ff',
                              textAlign: 'center'
                            }}>
                              <Text style={{ fontSize: '11px', color: '#1890ff', fontWeight: 'bold' }}>
                                <BarChartOutlined style={{ marginRight: '4px' }} />
                                –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
                              </Text>
                            </div>
                          </>
                        ) : (
                          <div>
                            <Tag color="orange" style={{ borderRadius: '12px' }}>
                              –û–ø–µ—Ä–∞—Ü–∏—è {machine.currentOperationId}
                            </Tag>
                            <div style={{ marginTop: '8px' }}>
                              <Text type="secondary" style={{ fontSize: '12px' }}>
                                –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª–µ–π...
                              </Text>
                            </div>
                            
                            <div style={{ 
                              marginTop: '12px', 
                              padding: '8px', 
                              backgroundColor: '#f0f9ff', 
                              borderRadius: '6px',
                              border: '1px dashed #1890ff',
                              textAlign: 'center'
                            }}>
                              <Text style={{ fontSize: '11px', color: '#1890ff' }}>
                                <BarChartOutlined style={{ marginRight: '4px' }} />
                                –û—Ç–∫—Ä—ã—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                              </Text>
                            </div>
                          </div>
                        )}
                      </Card>
                    </Col>
                  );
                })}
              </Row>
            </Card>
          );
        })}

      {/* –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π */}
      {activeOperations.length === 0 && (
        <Card 
          title={
            <Space>
              <PlayCircleOutlined style={{ color: '#52c41a' }} />
              <span style={{ color: '#52c41a', fontWeight: 'bold' }}>
                –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
              </span>
            </Space>
          }
          style={{ marginBottom: '24px', borderRadius: '12px' }}
        >
          <Empty
            image={Empty.PRESENTED_IMAGE_SIMPLE}
            description={
              <div>
                <Text type="secondary" style={{ fontSize: '16px' }}>
                  –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
                </Text>
                <div style={{ marginTop: '8px' }}>
                  <Text type="secondary" style={{ fontSize: '14px' }}>
                    –í—Å–µ —Å—Ç–∞–Ω–∫–∏ —Å–≤–æ–±–æ–¥–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ
                  </Text>
                </div>
              </div>
            }
          />
        </Card>
      )}

      {/* –ó–∞–Ω—è—Ç—ã–µ —Å—Ç–∞–Ω–∫–∏ –±–µ–∑ –æ–ø–µ—Ä–∞—Ü–∏–π */}
      {occupiedMachines.filter(m => !m.currentOperationDetails && !m.currentOperationId).length > 0 && (
        <Card 
          title={
            <Space>
              <ToolOutlined style={{ color: '#faad14' }} />
              <span style={{ color: '#faad14', fontWeight: 'bold' }}>
                –°—Ç–∞–Ω–∫–∏ —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è
              </span>
            </Space>
          }
          style={{ marginBottom: '24px', borderRadius: '12px' }}
        >
          <Alert
            message="‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ"
            description="–≠—Ç–∏ —Å—Ç–∞–Ω–∫–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –∑–∞–Ω—è—Ç—ã–µ, –Ω–æ –Ω–µ –∏–º–µ—é—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞."
            type="warning"
            showIcon
            style={{ marginBottom: '16px' }}
          />
          
          <Row gutter={[16, 16]}>
            {occupiedMachines
              .filter(m => !m.currentOperationDetails && !m.currentOperationId)
              .map((machine) => (
                <Col key={machine.id} xs={24} sm={12} lg={8}>
                  <Card
                    size="small"
                    hoverable
                    onClick={() => handleOperationClick(machine)}
                    style={{
                      borderRadius: '8px',
                      borderColor: '#faad14',
                      cursor: 'pointer'
                    }}
                  >
                    <Space style={{ width: '100%', justifyContent: 'space-between' }}>
                      <Space>
                        <ToolOutlined style={{ color: '#faad14' }} />
                        <Text strong>{machine.machineName}</Text>
                      </Space>
                      <Space>
                        <Tag color="orange">–ó–∞–Ω—è—Ç</Tag>
                        <EyeOutlined style={{ color: '#1890ff', fontSize: '12px' }} />
                      </Space>
                    </Space>
                  </Card>
                </Col>
              ))
            }
          </Row>
        </Card>
      )}

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ */}
      <EnhancedOperationAnalyticsModal
        visible={analyticsModalVisible}
        onClose={handleAnalyticsModalClose}
        machine={selectedMachine}
      />
    </div>
  );
};