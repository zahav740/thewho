@echo off
chcp 65001
echo.
echo ========================================================
echo ğŸ› ï¸ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞĞ¨Ğ˜Ğ‘ĞšĞ˜ 500 - ĞĞŸĞ•Ğ ĞĞ¢ĞĞ Ğ« (ĞŸĞĞ›ĞĞĞ•)
echo ========================================================
echo.

echo ğŸ“‹ Ğ­Ğ¢ĞĞŸ 1: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
echo.
psql -h localhost -p 5432 -U postgres -d thewho -f "ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ-Ğ˜-Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ•-ĞĞŸĞ•Ğ ĞĞ¢ĞĞ ĞĞ’.sql"

if %ERRORLEVEL% EQU 0 (
  echo âœ… Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°!
) else (
  echo âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Ğ‘Ğ”!
  echo ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ PostgreSQL Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½
  pause
  exit /b 1
)

echo.
echo ğŸ“‹ Ğ­Ğ¢ĞĞŸ 2: ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ²
echo.
echo ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ñ… 5100 Ğ¸ 5101...
for /f "tokens=5" %%a in ('netstat -aon ^| findstr ":5100" ^| findstr "LISTENING"') do (
  echo ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ %%a Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 5100
  taskkill /f /pid %%a >nul 2>&1
)

for /f "tokens=5" %%a in ('netstat -aon ^| findstr ":5101" ^| findstr "LISTENING"') do (
  echo ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ %%a Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 5101  
  taskkill /f /pid %%a >nul 2>&1
)

echo.
echo ğŸ“‹ Ğ­Ğ¢ĞĞŸ 3: Ğ—Ğ°Ğ¿ÑƒÑĞº Backend Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¼ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
echo.
cd backend

echo Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸...
call npm install >nul 2>&1

echo.
echo ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Backend Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 5100...
set NODE_ENV=production
set PORT=5100
call npm run start:prod

pause
