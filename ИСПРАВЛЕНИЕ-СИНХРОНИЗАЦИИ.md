# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏

## üêõ –ü—Ä–æ–±–ª–µ–º–∞
–û–ø–µ—Ä–∞—Ü–∏–∏, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –≤ —Å–µ–∫—Ü–∏–∏ **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ**, –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–µ–∫—Ü–∏–∏ **–°–º–µ–Ω—ã**.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–∏ –∫—ç—à–∞ –≤ ActiveMachinesMonitor
```typescript
// ‚ùå –ë–´–õ–û (—Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏):
queryKey: ['machines-availability']

// ‚úÖ –°–¢–ê–õ–û (–µ–¥–∏–Ω—ã–π –∫–ª—é—á):
queryKey: ['machines']
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞
```typescript
// –í PlanningModalImproved –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏:
queryClient.invalidateQueries({ queryKey: ['machines'] });
queryClient.invalidateQueries({ queryKey: ['machines-with-progress'] });
queryClient.invalidateQueries({ queryKey: ['operations'] });
queryClient.invalidateQueries({ queryKey: ['shifts'] });
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```typescript
message.success(`–û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –Ω–∞ —Å—Ç–∞–Ω–æ–∫ ${selectedMachine?.machineName}`);

setTimeout(() => {
  message.info('üîÑ –û–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Å–µ–∫—Ü–∏–∏ –°–º–µ–Ω—ã...', 3);
}, 1000);

setTimeout(() => {
  message.success('‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏!', 3);
}, 2000);
```

### 4. –£–º–µ–Ω—å—à–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```typescript
// –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
refetchInterval: 3000, // 3 —Å–µ–∫—É–Ω–¥—ã
staleTime: 1000,       // 1 —Å–µ–∫—É–Ω–¥–∞
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. üè≠ **–°–µ–∫—Ü–∏—è –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ** ‚Üí –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Ç–∏–ø–∞ —Å—Ç–∞–Ω–∫–∞ (MILLING/TURNING)
2. üìã **–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ** ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
3. üì± **–°–µ–∫—Ü–∏—è –°–º–µ–Ω—ã** ‚Üí –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É —Å—Ç–∞–Ω–∫–∞
4. ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Üí –û–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 1-3 —Å–µ–∫—É–Ω–¥

### –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- üìÑ **–ù–æ–º–µ—Ä —á–µ—Ä—Ç–µ–∂–∞** –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚è±Ô∏è **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** 
- üìä **–°–µ–∫—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞** —Å –Ω—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- üÜï **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ù–û–í–ê–Ø –û–ü–ï–†–ê–¶–ò–Ø"**

## üîß –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Frontend:
- `src/pages/Shifts/components/ActiveMachinesMonitor.tsx` ‚úèÔ∏è
- `src/components/PlanningModal/PlanningModalImproved.tsx` ‚úèÔ∏è

### Backend:
- `src/modules/machines/machines-status.controller.ts` ‚úÖ (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- `src/modules/machines/machine-assignment.controller.ts` ‚úÖ (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

## üìä API Flow

```
1. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ ‚Üí –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
   POST /api/machines/:id/assign-operation

2. Backend ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î:
   - operations.assignedMachine = machineId
   - machines.currentOperation = operationId
   - machines.isOccupied = true

3. –°–º–µ–Ω—ã ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
   GET /api/machines/status/all

4. Frontend ‚Üí –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
   - invalidateQueries(['machines'])
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏ **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ** –∏ **–°–º–µ–Ω—ã** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –≤ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –°–º–µ–Ω–∞—Ö

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –≤ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ –∏ —Å—Ä–∞–∑—É –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –°–º–µ–Ω–∞—Ö
‚úÖ –ï–¥–∏–Ω—ã–π –∫—ç—à –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (3 —Å–µ–∫—É–Ω–¥—ã)
