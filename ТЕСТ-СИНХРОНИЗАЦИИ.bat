@echo off
chcp 65001 > nul
echo.
echo üöÄ –¢–ï–°–¢ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –ü–†–û–ò–ó–í–û–î–°–¢–í–û ‚Üî –°–ú–ï–ù–´
echo.
echo –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ Production –∏ Shifts:
echo 1. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ: –í—ã–±–∏—Ä–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏—é ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –≤ –ë–î
echo 2. –°–º–µ–Ω–∞: –ü–æ–ª—É—á–∞–µ—Ç –≤–µ–±—Ö—É–∫ ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –ø–ª–∞–Ω
echo 3. –°–º–µ–Ω–∞: –î–µ–ª–∞–µ—Ç—Å—è –Ω–∞–ª–∞–¥–∫–∞ ‚Üí –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ë–î
echo 4. –°–º–µ–Ω–∞: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–±—ä–µ–º (–¥–µ–Ω—å/–Ω–æ—á—å) ‚Üí –∑–∞–ø–∏—Å–∞–ª–∏ –≤ –ë–î
echo 5. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É —Å—Ç–∞–Ω–∫–∞
echo.

REM –ë–∞–∑–æ–≤—ã–π URL API
set API_URL=http://localhost:5100/api

echo üè• 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...
curl -s -X GET "%API_URL%/sync/health"
echo.
echo.

echo üìã 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ç–∞–Ω–∫–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π...
REM –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å—Ç–∞–Ω–æ–∫
for /f "tokens=*" %%i in ('curl -s -X GET "%API_URL%/machines/availability" ^| jq -r ".[] | select(.isAvailable == true) | .id" ^| head -1') do set MACHINE_ID=%%i

REM –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
for /f "tokens=*" %%i in ('curl -s -X GET "%API_URL%/operations" ^| jq -r ".[] | select(.status == \"PENDING\" or .status == \"READY\") | .id" ^| head -1') do set OPERATION_ID=%%i

echo –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–æ–∫ ID: %MACHINE_ID%
echo –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é ID: %OPERATION_ID%
echo.

if "%MACHINE_ID%"=="" (
    echo ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞–Ω–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    echo    –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å —Å—Ç–∞–Ω–∫–∏ —Å isAvailable=true
    goto :end
)

if "%OPERATION_ID%"=="" (
    echo ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    echo    –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º PENDING –∏–ª–∏ READY
    goto :end
)

echo üéØ 3. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π...
curl -s -X POST "%API_URL%/planning/assign-operation" -H "Content-Type: application/json" -d "{\"operationId\": %OPERATION_ID%, \"machineId\": %MACHINE_ID%}"
echo.
echo.

timeout /t 2 /nobreak > nul

echo üìä 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏...
curl -s -X GET "%API_URL%/planning/sync-status/%OPERATION_ID%"
echo.
echo.

echo üî® 5. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ —Å–º–µ–Ω—ã (–∏–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è –°–º–µ–Ω—ã)...
REM –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
for /f "tokens=*" %%i in ('powershell -command "Get-Date -Format 'yyyy-MM-dd'"') do set TODAY=%%i

echo –¢–µ–∫—É—â–∏–µ —Å–º–µ–Ω—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏:
curl -s -X GET "%API_URL%/shifts?operationId=%OPERATION_ID%"
echo.
echo.

echo üìà 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ (–¥–µ–Ω—å: 10, –Ω–æ—á—å: 15)...
curl -s -X POST "%API_URL%/shifts" -H "Content-Type: application/json" -d "{\"date\": \"%TODAY%\", \"operationId\": %OPERATION_ID%, \"machineId\": %MACHINE_ID%, \"dayShiftQuantity\": 10, \"nightShiftQuantity\": 15, \"dayShiftOperator\": \"–¢–µ—Å—Ç –û–ø–µ—Ä–∞—Ç–æ—Ä –î–µ–Ω—å\", \"nightShiftOperator\": \"–¢–µ—Å—Ç –û–ø–µ—Ä–∞—Ç–æ—Ä –ù–æ—á—å\"}"
echo.
echo.

timeout /t 1 /nobreak > nul

echo üîÑ 7. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö...
curl -s -X POST "%API_URL%/sync/sync-all"
echo.
echo.

echo üìä 8. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...
curl -s -X GET "%API_URL%/planning/sync-status/%OPERATION_ID%"
echo.
echo.

echo üîß 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–∞–Ω–∫–∞...
curl -s -X GET "%API_URL%/machines/availability" | jq ".[] | select(.id == \"%MACHINE_ID%\")"
echo.
echo.

echo ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!
echo.
echo üìã –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
echo    - –û–ø–µ—Ä–∞—Ü–∏—è %OPERATION_ID% –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –Ω–∞ —Å—Ç–∞–Ω–æ–∫ %MACHINE_ID%
echo    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å —Å–º–µ–Ω—ã
echo    - –ó–∞–ø–∏—Å–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –æ–±—ä–µ–º: –î–µ–Ω—å 10 + –ù–æ—á—å 15 = 25 –¥–µ—Ç–∞–ª–µ–π
echo    - –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ Production –∏ Shifts
echo.
echo üéâ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

:end
echo.
pause
