@echo off
chcp 65001 >nul
color 0A
echo.
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
echo ‚ñà‚ñà                                                ‚ñà‚ñà
echo ‚ñà‚ñà  üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô –ó–ê–ü–£–°–ö –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –ü–†–û–ò–ó–í–û–î–°–¢–í–ê  ‚ñà‚ñà
echo ‚ñà‚ñà                                                ‚ñà‚ñà
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
echo.

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è
echo [1/7] üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É...
if not exist "frontend\src\pages\Production\components\MachineCard.tsx" (
    echo ‚ùå –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª MachineCard.tsx –Ω–µ –Ω–∞–π–¥–µ–Ω!
    pause
    exit /b 1
)
echo ‚úÖ MachineCard.tsx –Ω–∞–π–¥–µ–Ω

if exist "frontend\src\pages\Production\components\MachineCard.enhanced.tsx" (
    echo üóëÔ∏è –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–π —Ñ–∞–π–ª...
    del "frontend\src\pages\Production\components\MachineCard.enhanced.tsx"
)
echo ‚úÖ –î—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã

echo.
echo [2/7] üîß –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏...
cd frontend
if not exist "node_modules" (
    echo üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏...
    call npm install --silent
)
echo ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

echo.
echo [3/7] üéØ –ü—Ä–æ–≤–µ—Ä—è–µ–º TypeScript...
call npm run type-check >nul 2>&1
if %errorlevel% equ 0 (
    echo ‚úÖ TypeScript –æ—à–∏–±–æ–∫ –Ω–µ—Ç
) else (
    echo ‚ö†Ô∏è –ï—Å—Ç—å TypeScript –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º)
)

echo.
echo [4/7] üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º Backend...
cd ..\backend
REM –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ
curl -s http://localhost:5100/api/health >nul 2>&1
if %errorlevel% equ 0 (
    echo ‚úÖ Backend —É–∂–µ –∑–∞–ø—É—â–µ–Ω
) else (
    echo üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å backend...
    start /min "Backend-CRM" cmd /c "npm run start:dev"
    echo ‚è≥ –ñ–¥—ë–º –∑–∞–ø—É—Å–∫ backend (15 —Å–µ–∫)...
    timeout /t 15 /nobreak >nul
)

echo.
echo [5/7] üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º API...
for /L %%i in (1,1,5) do (
    curl -s http://localhost:5100/api/machines >nul 2>&1
    if !errorlevel! equ 0 (
        echo ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç
        goto api_ok
    )
    echo ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ %%i/5 - –∂–¥—ë–º API...
    timeout /t 3 /nobreak >nul
)
echo ‚ö†Ô∏è API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
:api_ok

echo.
echo [6/7] üé® –ó–∞–ø—É—Å–∫–∞–µ–º Frontend...
cd ..\frontend
REM –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ
netstat -an | findstr :3000 | findstr LISTENING >nul 2>&1
if %errorlevel% equ 0 (
    echo ‚úÖ Frontend —É–∂–µ –∑–∞–ø—É—â–µ–Ω
) else (
    echo üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å frontend...
    start /min "Frontend-CRM" cmd /c "npm start"
    echo ‚è≥ –ñ–¥—ë–º –∑–∞–ø—É—Å–∫ frontend (25 —Å–µ–∫)...
    timeout /t 25 /nobreak >nul
)

echo.
echo [7/7] üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥...
start "" "http://localhost:3000/#/production"
timeout /t 3 /nobreak >nul

echo.
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
echo ‚ñà‚ñà                                                ‚ñà‚ñà
echo ‚ñà‚ñà  ‚úÖ –ú–û–ù–ò–¢–û–†–ò–ù–ì –ü–†–û–ò–ó–í–û–î–°–¢–í–ê –ó–ê–ü–£–©–ï–ù!           ‚ñà‚ñà
echo ‚ñà‚ñà                                                ‚ñà‚ñà
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
echo.
echo üìä –ü–†–û–í–ï–†–¨–¢–ï:
echo    ‚Ä¢ –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞–Ω–∫–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
echo    ‚Ä¢ –ü–æ–∫–∞–∑–∞–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–æ–º–µ—Ä–∞, —Ç–∏–ø—ã, –≤—Ä–µ–º—è)
echo    ‚Ä¢ –ö–Ω–æ–ø–∫–∏ "–û—Å–≤–æ–±–æ–¥–∏—Ç—å/–ó–∞–Ω—è—Ç—å" —Ä–∞–±–æ—Ç–∞—é—Ç
echo    ‚Ä¢ –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
echo.
echo üîó –°–°–´–õ–ö–ò:
echo    Frontend: http://localhost:3000/#/production
echo    Backend:  http://localhost:5100/api/machines
echo.
echo üõ†Ô∏è –ï–°–õ–ò –ü–†–û–ë–õ–ï–ú–´:
echo    1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
echo    2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
echo    3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç
echo.
pause
